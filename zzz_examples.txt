cd anoma_v0.8

#   step1
    DATASET_PATH, FRAME_SUFFIX, FRAME_SIZE, CLIP_LEN, STEP, OPTICAL, CRITERIA, TYPE = (
        ('/absolute/datasets/anoma', '.jpg', (240, 320),
         16, 16, 2, (cv2.TERM_CRITERIA_EPS | cv2.TERM_CRITERIA_COUNT, 10, 1), 'pyramid_120_85'),
        ('/absolute/datasets/anoma', '.jpg', (240, 320),
         16, 16, 2, (cv2.TERM_CRITERIA_EPS | cv2.TERM_CRITERIA_COUNT, 10, 1), 'pyramid_80_56'),
        ('/absolute/datasets/anoma', '.jpg', (240, 320),
         16, 16, 2, (cv2.TERM_CRITERIA_EPS | cv2.TERM_CRITERIA_COUNT, 10, 1), 'pyramid_60_42'),
        ('/absolute/datasets/anoma', '.jpg', (240, 320), 16, 16, 2, None, 'original'),
        ('/absolute/datasets/UCSDped2_reform', '.tif', (240, 360),
         16, 8, 2, (cv2.TERM_CRITERIA_EPS | cv2.TERM_CRITERIA_COUNT, 10, 1), 'pyramid_120_85'),
        ('/absolute/datasets/UCSDped2_reform', '.tif', (240, 360),
         16, 8, 2, (cv2.TERM_CRITERIA_EPS | cv2.TERM_CRITERIA_COUNT, 10, 1), 'pyramid_80_56'),
        ('/absolute/datasets/UCSDped2_reform', '.tif', (240, 360),
         16, 8, 2, (cv2.TERM_CRITERIA_EPS | cv2.TERM_CRITERIA_COUNT, 10, 1), 'pyramid_60_42'),
        ('/absolute/datasets/UCSDped2_reform', '.tif', (240, 360), 16, 8, 2, None, 'original'),
    )[F.var1]

python3 zclips_all2json_extract.py -multiprocessing=True -var1=0

#   step2
    JSON_FILE_FOLDER, DATASET_PATH = (
        ('/absolute/datasets/anoma_motion_pyramid_120_85_all_json', '/absolute/datasets/anoma'),
        ('/absolute/datasets/anoma_motion_pyramid_80_56_all_json', '/absolute/datasets/anoma'),
        ('/absolute/datasets/anoma_motion_pyramid_60_42_all_json', '/absolute/datasets/anoma'),
        ('/absolute/datasets/anoma_motion_original_all_json', '/absolute/datasets/anoma'),
        'TYPE')[F.var1]

python3 zclips_json2npy_c3d.py -var1=0  -cpu0=0 -cpu1=0 -cpu2=0 -cpu3=0

#   step3
    NPY_FILE_FOLDER, SEGMENT_NUM, TEST_FILE = (
        ('/absolute/datasets/anoma_motion_pyramid_120_85_c3d_npy', 32,
         '/absolute/datasets/Anomaly-Detection-Dataset/Temporal_Anomaly_Annotation_for_Testing_Videos.txt'),
        ('/absolute/datasets/anoma_motion_pyramid_80_56_c3d_npy', 32,
         '/absolute/datasets/Anomaly-Detection-Dataset/Temporal_Anomaly_Annotation_for_Testing_Videos.txt'),
        ('/absolute/datasets/anoma_motion_pyramid_60_42_c3d_npy', 32,
         '/absolute/datasets/Anomaly-Detection-Dataset/Temporal_Anomaly_Annotation_for_Testing_Videos.txt'),
        ('/absolute/datasets/anoma_motion_original_c3d_npy', 32,
         '/absolute/datasets/Anomaly-Detection-Dataset/Temporal_Anomaly_Annotation_for_Testing_Videos.txt'),
        ('/absolute/datasets/anoma_motion_pyramid_120_85_c3d_npy', 32,
         '/absolute/datasets/Anomaly-Detection-Dataset/Temporal_Anomaly_Annotation_for_Testing_Videos.txt'),
        ('/absolute/datasets/anoma_motion_pyramid_80_56_c3d_npy', 32,
         '/absolute/datasets/Anomaly-Detection-Dataset/Temporal_Anomaly_Annotation_for_Testing_Videos.txt'),
        ('/absolute/datasets/anoma_motion_pyramid_60_42_c3d_npy', 32,
         '/absolute/datasets/Anomaly-Detection-Dataset/Temporal_Anomaly_Annotation_for_Testing_Videos.txt'),
        ('/absolute/datasets/anoma_motion_original_c3d_npy', 32,
         '/absolute/datasets/Anomaly-Detection-Dataset/Temporal_Anomaly_Annotation_for_Testing_Videos.txt'))[F.var1]
    MULTISCALE, MULTIREGION = (('single', 1), ('single', 4), ('pyramid', 1), ('pyramid', 4), (None, None))[F.var2]

python3 zclips_npy2npy_reform.py -multiprocessing=True -var1=0 -var2=0

#   step4
    tags.DEFINE_integer('batch_size', 64, 'batch size.')
    tags.DEFINE_integer('epoch_num', 900, 'epoch number.')
    tags.DEFINE_float('learning_rate_base', 0.001, 'learning rate base')
    tags.DEFINE_float('moving_average_decay', 0.99, 'moving average decay')
    tags.DEFINE_float('regularization_scale', 0.00003, 'regularization scale')
    tags.DEFINE_string('fusion', 'standard', 'fusion ways in feature extraction')
    tags.DEFINE_string('npy_file_path',
                       '/absolute/datasets/anoma_motion_4training_single_120_85_1region_c3d_npy',
                       'npy file path')
    tags.DEFINE_string('training_list',
                       '/absolute/datasets/Anomaly-Detection-Dataset/Anomaly_Train.txt',
                       'default to UCFCrime, else specific to UCSD.')
    tags.DEFINE_string('set_gpu', '0', 'Single gpu version, index select')

python3 zc3d_npy_train.py -npy_file_path=/absolute/datasets/anoma_motion_4training_single_120_85_1region_c3d_npy -set_gpu=0
                          -training_list=/absolute/datasets/Anomaly-Detection-Dataset/Anomaly_Train.txt
                          -batch_size=64 -epoch_num=900 -learning_rate_base=0.001 -moving_average_decay=0.99 -regularization_scale=0.00003 -fusion=standard

#    step5
    tags.DEFINE_string('save_file_path',
                       '/absolute/tensorflow_models/190912162832_anoma_motion_4training_pyramid_80_56_4region_c3d_npy/190912162832.ckpt-1',
                       'model folder path, or model ckpt file path.')
    tags.DEFINE_string('set_gpu', '0', 'Single gpu version, index select')
    tags.DEFINE_string('testing_list',
                       '/absolute/datasets/Anomaly-Detection-Dataset/Temporal_Anomaly_Annotation_for_Testing_Videos.txt',
                       'test samples from the list, default for UCFCrime,'
                       'else for USCD: e.g. /absolute/datasets/UCSDped2_split_list/10_fold_001/v01_test.txt')

python3 zc3d_npy_eval.py -save_file_path=/absolute/tensorflow_models/190912162832_anoma_motion_4training_pyramid_80_56_4region_c3d_npy/190912162832.ckpt-1
                         -set_gpu=0 -testing_list=/absolute/datasets/Anomaly-Detection-Dataset/Temporal_Anomaly_Annotation_for_Testing_Videos.txt

